/**
 * Copyright Antti Lamminsalo, 2014
 */
function _longPressDown(e,t){function i(){clearTimeout(lptimer),n.removeEventListener("touchend",i),n.removeEventListener("touchmove",i)}e.stopPropagation();var n=t||this;n.addEventListener("touchend",i),n.addEventListener("touchmove",i),lptimer=setTimeout(function(){e.preventDefault(),i(),showContextMenu(e,n)},1e3)}function createSortables(){plSortable=Sortable.create(playlistsDOM,{animation:50,draggable:".container",ghostClass:"ghost",onUpdate:function(e){playlists.dragSort(e.oldIndex,e.newIndex),refreshPlaylists(),saveStoredPlaylists()}}),Sortable.create(playlistDOM,{animation:50,draggable:".container",ghostClass:"ghost",onUpdate:function(e){selectedList.items.dragSort(e.oldIndex,e.newIndex),refresh(),saveStoredPlaylists()}}),Sortable.create(queueDOM,{animation:50,draggable:".container",ghostClass:"ghost",onUpdate:function(e){queue.items.dragSort(e.oldIndex,e.newIndex),queue.update()}})}function dropItem(e){console.log(e.dataTransfer.getData("el")),e.preventDefault(),console.log(e.target)}function onItemDrag(e,t){e.dataTransfer.setData("el",t)}function onLoaded(){fillStorageIfEmpty(),loadStoredPlaylists(),selectedList=playlists[0],window.location.href.indexOf("#")!==-1&&parseURI(window.location.href),setupListeners()}function getContainer(e,t){for(;e.parentNode!==t;)e=e.parentNode;return e.className.match(/container|result/i)?e:null}function setupDelegate(e,t,i,n,s){e.addEventListener(t,function(e){var t=getContainer(e.target,this);t&&(s?i(e,n?t:t.getAttribute("index")):i(n?t:t.getAttribute("index")))})}function setupListeners(){document.getElementById("nextButton").addEventListener("click",getNext),document.getElementById("prevButton").addEventListener("click",getPrev),document.getElementById("playIcon").addEventListener("click",togglePause),document.getElementById("clearSearchButton").addEventListener("click",clearSearch),document.getElementById("addPlaylistButton").addEventListener("click",addPlaylist),document.getElementById("queueButton").addEventListener("click",toggleQueue),document.getElementById("shuffleButton").addEventListener("click",toggleShuffle),document.getElementById("img-wrap").addEventListener("click",showOverlayPlayer),setupDelegate(playlistDOM,"click",selectItem),setupDelegate(playlistsDOM,"click",selectPlaylist),setupDelegate(resultsDOM,"click",addResultAndCloseSearch,!0),setupDelegate(queueDOM,"click",skipQueueTo),setupDelegate(playlistsDOM,"dblclick",editPlaylist),document.body.addEventListener("contextmenu",showContextMenu),document.getElementById("playlists-wrap").addEventListener("contextmenu",showContextMenu),setupDelegate(playlistDOM,"contextmenu",showContextMenu,!0,!0),setupDelegate(playlistsDOM,"contextmenu",showContextMenu,!0,!0),setupDelegate(resultsDOM,"contextmenu",showContextMenu,!0,!0),setupDelegate(queueDOM,"contextmenu",showContextMenu,!0,!0),isMobile()||document.getElementById("listHandle").addEventListener("mousedown",function(e){var t=document.getElementById("playlists-wrap"),i=e.clientX,n=t.offsetWidth,s=!0,a=function(e){s&&(t.style.width=n+e.clientX-i+"px")};t.parentNode.addEventListener("mousemove",a),t.parentNode.addEventListener("mouseup",function e(){s=!1,t.parentNode.removeEventListener("mousemove",a),t.parentNode.removeEventListener("mouseup",e)},!1)},!1),isMobile()&&(document.body.addEventListener("touchstart",_longPressDown),document.getElementById("playlists-wrap").addEventListener("touchstart",_longPressDown),setupDelegate(playlistDOM,"touchstart",_longPressDown,!0,!0),setupDelegate(playlistsDOM,"touchstart",_longPressDown,!0,!0),setupDelegate(resultsDOM,"touchstart",_longPressDown,!0,!0),setupDelegate(queueDOM,"touchstart",_longPressDown,!0,!0)),document.getElementById("posBar").addEventListener("click",function(e){if(activeItem&&1===player.getPlayerState()||2===player.getPlayerState()||3===player.getPlayerState()){var t=(e.pageX-this.offsetLeft)/this.offsetWidth;player.seekTo(activeItem.timesecs*t),document.getElementById("posfg").style.width=100*t+"%"}},!1),document.getElementById("searchbox").addEventListener("input",function(){setTimeout(function(){search()},400)},!1),document.addEventListener("keydown",function(e){switch(e.keyCode){case 32:if("INPUT"!==document.activeElement.nodeName)return togglePause(),e.preventDefault(),!1;break;case 39:"INPUT"!==document.activeElement.nodeName&&getNext();break;case 37:"INPUT"!==document.activeElement.nodeName&&getPrev();break;case 81:e.ctrlKey&&document.getElementById("searchbox").focus();break;case 90:e.ctrlKey&&addPlaylist();break;case 49:"INPUT"!==document.activeElement.nodeName&&playlists.length>0&&selectPlaylist(0);break;case 50:"INPUT"!==document.activeElement.nodeName&&playlists.length>1&&selectPlaylist(1);break;case 51:"INPUT"!==document.activeElement.nodeName&&playlists.length>2&&selectPlaylist(2);break;case 52:"INPUT"!==document.activeElement.nodeName&&playlists.length>3&&selectPlaylist(3);break;case 53:"INPUT"!==document.activeElement.nodeName&&playlists.length>4&&selectPlaylist(4);break;case 54:"INPUT"!==document.activeElement.nodeName&&playlists.length>5&&selectPlaylist(5);break;case 55:"INPUT"!==document.activeElement.nodeName&&playlists.length>6&&selectPlaylist(6);break;case 56:"INPUT"!==document.activeElement.nodeName&&playlists.length>7&&selectPlaylist(7);break;case 57:"INPUT"!==document.activeElement.nodeName&&playlists.length>8&&selectPlaylist(8)}})}function parseURI(e){var t=/playeri\.net\/?#.+=/;if(e.match(t)){e=e.slice(e.indexOf("#")+1);var i=e.slice(0,e.indexOf("=")),n=e.slice(e.indexOf("=")+1).split(",");playlists.push(new Playlist(decodeURIComponent(i)+" (Shared)")),fetchItems(n,playlists.last()),window.location.hash=""}}function parseDuration(e,t){e=e.slice(e.indexOf("PT")+2);var i=e.substr(0,e.indexOf("H"));e=e.slice(e.indexOf("H")+1);var n=e.substr(0,e.indexOf("M"));e=e.slice(e.indexOf("M")+1);var s=e.substr(0,e.indexOf("S"));e="",t.timesecs=0,i&&(e+=i+":",t.timesecs+=3600*parseInt(i)),n?(e+=n+":",t.timesecs+=60*parseInt(n)):e+="0:",s?(e+=s.length>1?s:"0"+s,t.timesecs+=parseInt(s)):e+="00",t.duration=e}function secondsToTime(e){e+=1;var t=e%60,i=Math.floor(e/60),n=null;return i>59&&(n=Math.floor(i/60),i%=60),(n?n+":":"")+i+":"+(t<10?"0":"")+t}function matchYoutubeUrl(e){var t=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return!!e.match(t)&&RegExp.$1}function showPlayer(){document.getElementById("current-wrap").style.marginBottom="0",playerVisible=!0}function hidePlayer(){document.getElementById("current-wrap").style.marginBottom="-48px",playerVisible=!1}function onPlayerReady(){onLoaded()}function onPlayerStateChange(e){switch(e.data){case YT.PlayerState.ENDED:getNext();break;case YT.PlayerState.PLAYING:document.getElementById("playIcon").classList.remove("icon-play"),document.getElementById("playIcon").classList.add("icon-pause"),HighQuality?player.setPlaybackQuality(player.getAvailableQualityLevels()[0]):player.setPlaybackQuality("suggestedQuality"),errorCounter=0;break;case YT.PlayerState.PAUSED:document.getElementById("playIcon").classList.remove("icon-pause"),document.getElementById("playIcon").classList.add("icon-play")}}function onError(){activeItem.setError(),errorCounter++,getNext()}function onYouTubeIframeAPIReady(){player=new YT.Player("player",{height:"100%",width:"100%",playerVars:{autohide:"1",controls:"1",iv_load_policy:"3"},events:{onStateChange:onPlayerStateChange,onReady:onPlayerReady,onError:onError}})}function clearSearch(){document.getElementById("searchbox").value="",resultsDOM.clear(),document.getElementById("results-wrap").style.height="0",tokenList="",document.getElementById("clearSearchButton").classList.add("hidden")}function search(e){if(e||(e="",tokenList=[]),matchYoutubeUrl(document.getElementById("searchbox").value)){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(document.getElementById("searchbox").value="",4===this.readyState){var e=JSON.parse(t.responseText);toPlaylist(e.items[0].id,e.items[0].snippet.title,e.items[0].contentDetails.duration,selectedList)}},t.open("GET","https://www.googleapis.com/youtube/v3/videos?key="+APIkey+"&part=snippet,contentDetails&fields=items(id,snippet(title),contentDetails(duration))&id="+matchYoutubeUrl(document.getElementById("searchbox").value),!0),t.send()}else if(document.getElementById("searchbox").value){document.getElementById("clearSearchButton").classList.remove("hidden");var i=document.getElementById("searchbox").value.toLowerCase();i=i.replace(/' '/g,"%20");var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===this.readyState&&document.getElementById("searchbox").value){var t=JSON.parse(n.responseText);nextToken=t.nextPageToken,document.getElementById("results-wrap").style.height="100%",e||(resultsDOM.clear(),document.getElementById("results-wrap").scrollTop=0);for(var i=[],s=[],a=0;a<25&&a<t.pageInfo.totalResults;a++)null!==t.items[a]&&(i[a]=document.createElement("div"),i[a].className=a%2===0?"result":"result lighter",createResultTemplate(i[a],t.items[a]),i[a].getAttribute("data-pid")&&s.push(i[a]),resultsDOM.appendChild(i[a]));getPlaylistItemsCount(s),document.getElementById("results-wrap").addEventListener("scroll",_scrollEvent,!0)}},n.open("GET","https://www.googleapis.com/youtube/v3/search?key="+APIkey+"&part=snippet&fields=nextPageToken,pageInfo(totalResults),items(id(videoId,playlistId),snippet(title,thumbnails(default)))&maxResults=25&type=video,playlist&q="+i+"&pageToken="+e,!0),n.send()}else document.getElementById("results-wrap").style.height="0",document.getElementById("clearSearchButton").classList.add("hidden"),tokenList=""}function createResultTemplate(e,t){e.innerHTML='<span class="title">'+t.snippet.title+"</span>",t.id.videoId?(e.innerHTML+='<span class="inforight result-item">Item</span>',e.setAttribute("data-vid",t.id.videoId)):(e.innerHTML+='<span class="inforight result-pl">Playlist</span>',e.setAttribute("data-pid",t.id.playlistId)),e.innerHTML+='<span class="thumbnail"><img src="'+t.snippet.thumbnails["default"].url+'" height="40"/></span>',e.setAttribute("data-title",t.snippet.title),e.setAttribute("_context","result")}function getPlaylistItemsCount(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)for(var i=JSON.parse(t.responseText),n=0;n<e.length;n++)e[n].children[1].textContent+=" ("+i.items[n].contentDetails.itemCount+")"};for(var i="https://www.googleapis.com/youtube/v3/playlists?key="+APIkey+"&part=contentDetails&fields=items(id,contentDetails)&id=",n=0;n<e.length;n++)i+=(n>0?",":"")+e[n].getAttribute("data-pid");t.open("GET",i,!0),t.send()}function addResultAndCloseSearch(e){e.getAttribute("data-pid"),addResult(e,playlists.last()),clearSearch(),selectPlaylist(playlists.length-1)}function addResult(e,t){t=t||selectedList,t&&playlists.indexOf(t)!==-1||(addPlaylist(),t=selectedList),t.setSpinner(!0),e.getAttribute("data-vid")?toPlaylist(e.getAttribute("data-vid"),e.getAttribute("data-title"),!1,t):e.getAttribute("data-pid")&&(arrangePlaylist(e.getAttribute("data-pid"),t),t.renamed||(t.title=e.getAttribute("data-title"),t.Container.children[0].innerHTML=e.getAttribute("data-title"),t.renamed=!0)),e.children[0].innerHTML+='<span class = "svgicon active2 icon-check"></span>',refresh()}function fetchItems(e,t,i){if(t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===this.readyState){for(var s=JSON.parse(n.responseText),a=0;a<s.items.length;a++)toPlaylist(s.items[a].id,s.items[a].snippet.title,s.items[a].contentDetails.duration,t);e.length>0?fetchItems(e,t,i):(t.setSpinner(!1),i&&saveStoredPlaylists(),refresh())}};var s="https://www.googleapis.com/youtube/v3/videos?key="+APIkey+"&part=snippet,contentDetails&fields=items(id,snippet(title),contentDetails(duration))&id="+e.splice(0,50).join();n.open("GET",s,!0),n.send(),t.setSpinner(!0)}}function arrangePlaylist(e,t,i,n){var s=new XMLHttpRequest;n=n||[],s.onreadystatechange=function(){if(4===this.readyState){for(var i=JSON.parse(s.responseText),a=0;a<i.items.length;a++)i.items[a].snippet.title&&"Private video"!==i.items[a].snippet.title&&n.push(i.items[a].snippet.resourceId.videoId);i.nextPageToken?arrangePlaylist(e,t,i.nextPageToken,n):fetchItems(n,t,!0)}},i=i||"",s.open("GET","https://www.googleapis.com/youtube/v3/playlistItems?key="+APIkey+"&part=snippet&maxResults=50&playlistId="+e+"&fields=nextPageToken,items/snippet(title,resourceId/videoId)&pageToken="+i,!0),s.send()}function getListOf(e){for(var t=0;t<playlists.length;t++)if(playlists[t].items.indexOf(e)!==-1)return playlists[t];return null}function playVideo(e){e&&(activeItem&&activeItem.Container.classList.remove("active"),activeItem=e,activeItem.Container.classList.add("active"),player.loadVideoById(activeItem.videoId),document.getElementById("current-title").textContent=activeItem.title,document.getElementById("current-duration").textContent="0:00/"+activeItem.duration,document.title=activeItem.title,activeList&&activeList.items.indexOf(activeItem)===-1&&(activeList=getListOf(activeItem)||activeList),playerVisible||showPlayer(),isPlaying=!0,intervalId&&clearInterval(intervalId),intervalId=setInterval(function(){activeItem&&(document.getElementById("posfg").style.width=100*player.getCurrentTime()/activeItem.timesecs+"%",document.getElementById("current-duration").textContent=secondsToTime(parseInt(player.getCurrentTime()))+"/"+activeItem.duration)},1e3))}function togglePause(){2!==player.getPlayerState()?player.pauseVideo():player.getPlayerState()!==-1&&player.playVideo(),isPlaying||(showPlayer(),playVideo(activeList.items[0]))}function getNext(){queue.hasItems()?playVideo(queue.popItem()):activeItem&&activeList&&activeList.items.length>0&&errorCounter<activeList.items.length?playVideo(activeList.getNext(activeItem)):stopPlaying()}function getPrev(){activeItem&&activeList&&activeList.items.length>0?playVideo(activeList.getPrevious(activeItem)):stopPlaying()}function stopPlaying(){document.title="Playeri.net - Play music and videos from YouTube",player.stopVideo(),player.clearVideo(),hidePlayer(),isPlaying=!1}function toggleShuffle(){var e=document.getElementById("shuffleButton");e.classList.toggle("alt"),ShuffleOn=!ShuffleOn,ShuffleOn&&activeList.createShuffle()}function Item(e,t,i,n){this.title=t,this.duration="",this.videoId=e,this.Container=document.createElement("li"),this.Container.className="container",this.Container.setAttribute("_context","item"),this.Container.setAttribute("index",n),this.timesecs="",parseDuration(i,this),this.Container.innerHTML='<span class="title">'+this.title+'</span><span class="inforight">'+this.duration+"</span>",Item.prototype.setError||(Item.prototype.setError=function(){this.Container.classList.add("error")})}function _onItemContext(e){showContextMenu(e,getContainer(e.target))}function selectItem(e){var t=selectedList.items[e];t&&activeItem!==t&&(activeList!==selectedList&&(activeList=selectedList),playVideo(t))}function removeItem(e,t){t=t||selectedList,t.removeItem(e)}function fetchItem(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==this.readyState){var n=JSON.parse(i.responseText);null!=n.items[0]&&(t.addItem(e,n.items[0].snippet.title,n.items[0].contentDetails.duration),saveStoredPlaylists(),t.setSpinner(!1),refreshPlaylists())}},i.open("GET","https://www.googleapis.com/youtube/v3/videos?key="+APIkey+"&part=snippet,contentDetails&fields=items(contentDetails(duration),snippet(title))&id="+e,!0),i.send()}function toPlaylist(e,t,i,n){e&&(t&&i?(n.addItem(e,t,i),n.setSpinner(!1)):fetchItem(e,n))}function refresh(){if(playlistDOM.clear(),refreshPlaylists(),QueueVisible)queue.update();else if(selectedList){selectedList.refreshItems();for(var e=0;e<selectedList.items.length;e++)playlistDOM.appendChild(selectedList.items[e].Container)}}function Playlist(e){this.title=e,this.index=playlists.length,this.items=[],this.renamed=!1,this.Container=document.createElement("li"),this.Container.className="container",this.shuffleList=[],this.loading=!1,this.Container.setAttribute("index",this.index),this.Container.setAttribute("_context","playlist"),this.Container.setAttribute("title","Double click to rename"),this.titleDOM=document.createElement("span"),this.titleDOM.className="title",this.titleDOM.textContent=e,this.renameDOM=document.createElement("span"),this.renameDOM.className="title hidden",this.renameDOM.innerHTML='<input class="playlist-rename textbox" type="text">',this.countDOM=document.createElement("span"),this.countDOM.className="inforight",this.countDOM.textContent="0",this.Container.appendChild(this.titleDOM),this.Container.appendChild(this.renameDOM),this.Container.appendChild(this.countDOM),Playlist.prototype.createShuffle||(Playlist.prototype.createShuffle=function(){if(this.shuffleList=[],this.items.length>1){for(var e=0;e<this.items.length;e++)this.shuffleList[e]=e;for(var t=this.shuffleList.length-1;t>0;t--){var i=Math.floor(Math.random()*t),n=this.shuffleList[i];this.shuffleList[i]=this.shuffleList[t],this.shuffleList[t]=n}}}),Playlist.prototype.getNext||(Playlist.prototype.getNext=function(e){var t=this.items.indexOf(e);if(t!==-1)return t++,!ShuffleOn||this.items.length<3?t<this.items.length?this.items[t]:this.items[0]:(this.shuffleList.length!==this.items.length&&this.createShuffle(),t<this.items.length?this.items[this.shuffleList[t]]:this.items[this.shuffleList[0]])}),Playlist.prototype.getPrevious||(Playlist.prototype.getPrevious=function(e){var t=this.items.indexOf(e);if(t!==-1)return t--,!ShuffleOn||this.items.length<3?t>-1?this.items[t]:this.items.last():t>0?this.items[this.shuffleList[t]]:this.items[this.shuffleList.last()]}),Playlist.prototype.refreshItems||(Playlist.prototype.refreshItems=function(){for(var e=0;e<this.items.length;e++)this.items[e].Container.setAttribute("index",e)}),Playlist.prototype.setSpinner||(Playlist.prototype.setSpinner=function(e){this.countDOM.className=e?"inforight spinner icon-spin3":"inforight"}),Playlist.prototype.addItem||(Playlist.prototype.addItem=function(e,t,i){var n=this.items.length;this.items.push(new Item(e,t,i)),this.items.last().Container.setAttribute("index",n),this.countDOM.textContent=this.items.length,this===selectedList&&playlistDOM.appendChild(this.items.last().Container)}),Playlist.prototype.removeItem||(Playlist.prototype.removeItem=function(e){var t=this.items[e];t&&(t.Container.removeAttribute("onclick"),t===activeItem&&getNext(),this===selectedList&&playlistDOM.removeChild(t.Container),this.items.splice(e,1),this.countDOM.textContent=this.items.length,this.refreshItems(),saveStoredPlaylists())}),0===this.index&&(this.Container.classList.add("activePl"),activeList=this),playlistsDOM.appendChild(this.Container)}function refreshPlaylists(){for(var e=0;e<playlists.length;e++)playlists[e].Container.setAttribute("index",e)}function editPlaylist(e){var t=playlists[e];if(t&&editedPlaylist!==t){!isMobile()&&plSortable&&plSortable.option("disabled",!0),editedPlaylist=t,t.Container.classList.add("editing");var i=t.Container.children[0];localStorage.removeItem("playlist_"+i.getAttribute("title")),i.classList.add("hidden");var n=t.Container.children[1];n.classList.remove("hidden"),n=n.children[0],n.value=i.textContent,n.select(),n.focus(),n.addEventListener("blur",_renameDone),n.addEventListener("keyup",_renameDone)}}function selectPlaylist(e){var t=playlists[e];t&&(QueueVisible||selectedList!==t)&&(QueueVisible&&toggleQueue(),selectedList&&selectedList.Container.classList.remove("activePl"),selectedList=t,selectedList.Container.classList.add("activePl"),refresh())}function removePlaylist(e){var t=playlists[e];if(t){t.Container.removeAttribute("onclick"),t.Container.removeAttribute("ondblclick"),t!==activeList||queue.hasItems()||(activeList=null,stopPlaying()),t===selectedList&&(selectedList=null,t.items=[]),t.Container.parentNode.removeChild(t.Container),playlists.removeObj(t);for(var i=e;i<playlists.length;i++)playlists[i].index--;refresh(),saveStoredPlaylists()}}function fillStorageIfEmpty(){localStorage.getItem("playlist_names")||(localStorage.setItem("playlist_Playlist 1",JSON.stringify([])),localStorage.setItem("playlist_names",JSON.stringify(["Playlist 1"])))}function saveStoredPlaylists(){localStorage.clear();for(var e=[],t=new Date,i=t.getTime(),n=0;n<playlists.length;n++){e.push(playlists[n].title+"|"+(i+n));for(var s=[],a=0;a<playlists[n].items.length;a++)s.push(playlists[n].items[a].videoId);localStorage.setItem("playlist_"+playlists[n].title+"|"+(i+n),JSON.stringify(s))}localStorage.setItem("playlist_names",JSON.stringify(e))}function loadStoredPlaylists(){for(var e=JSON.parse(localStorage.getItem("playlist_names")),t=0;t<e.length;t++){var i=localStorage.getItem("playlist_"+e[t]);playlists.push(new Playlist(e[t].split("|")[0]));var n=JSON.parse(i);fetchItems(n,playlists[t])}playlists[0]||addPlaylist()}function addPlaylist(){playlists.push(new Playlist("Playlist "+(playlists.length+1))),selectPlaylist(playlists.length-1)}function createClickGuard(){var e=document.createElement("div");document.body.appendChild(e),e.id="clickGuard",e.className="screen",e.style.zIndex="99",e.addEventListener("click",function(e){hideContextMenu(),e.stopPropagation(),e.preventDefault()}),e.addEventListener("contextmenu",function(e){hideContextMenu(),e.stopPropagation(),e.preventDefault()})}function showContextMenu(e,t){hideContextMenu(),e.preventDefault(),e.stopPropagation();var i=t||this;e=e||window.event,createClickGuard();var n=getPosition(e);i.classList.add("hover-on"),contextMenu=document.createElement("table"),contextMenu.className="dark-ui contextmenu",contextMenu.addEventListener("click",hideContextMenu);var s=i.getAttribute("index");switch(i.getAttribute("_context")){case"playlist-add":contextMenu.innerHTML='<tr class="menuitem" onclick="addPlaylist()"><td class="svgicon menuicon icon-plus"></td><td>New Playlist</td></tr>';break;case"playlist":contextMenu.innerHTML='<tr class="menuitem" onclick="selectPlaylist('+s+')"><td class="svgicon menuicon icon-eye"></td><td>Show</td></tr><tr class="menuitem" onclick="editPlaylist('+s+')"><td class="svgicon menuicon icon-pencil"></td><td>Edit</td></tr><tr class="menuitem" onclick="share('+s+')"><td class="svgicon menuicon icon-link"></td><td>Share</td></tr><tr class="menuitem" onclick="removePlaylist('+s+')"><td class="svgicon menuicon icon-cancel"></td><td>Remove</td></tr>';break;case"item":contextMenu.innerHTML='<tr class="menuitem" onclick="addToQueue('+s+')"><td class="svgicon menuicon icon-list-add"></td><td class="menuEntry">Queue</td></tr><tr class="menuitem" onclick="selectItem('+s+')"><td class="svgicon menuicon icon-play"></td><td class="menuEntry">Play</td></tr><tr class="menuitem" onclick="showItemUrl('+s+')"><td class="svgicon menuicon icon-link"></td><td class="menuEntry">Get Link</td></tr><tr class="menuitem" onclick="removeItem('+s+')"><td class="svgicon menuicon icon-cancel"></td><td class="menuEntry">Remove</td></tr>';break;case"result":contextMenu.innerHTML=(selectedList?'<tr class="menuitem"><td class="svgicon menuicon icon-plus"></td><td>Add to '+selectedList.title+"</td></tr>":'<tr style="display:none;"><td></td><td></td></tr>')+'<tr class="menuitem"><td class="svgicon menuicon icon-level-down"></td><td>To new playlist</td></tr>';var a=contextMenu.children[0].children[0];a.addEventListener("click",function(){addResult(i,null)});var l=contextMenu.children[0].children[1];l.addEventListener("click",function(){playlists.push(new Playlist("Playlist "+(playlists.length+1))),addResult(i,playlists.last())});break;case"queue":contextMenu.innerHTML='<tr class="menuitem" onclick="skipQueueTo('+s+')"><td class="svgicon menuicon icon-level-down"></td><td>Skip to this</td></tr><tr class="menuitem" onclick="removeQueueItem('+s+')"><td  class="svgicon menuicon icon-cancel"></td><td>Remove</td></tr>';break;case"about":contextMenu.innerHTML='<tr class="menuitem" onclick="showAbout()"><td class="svgicon menuicon icon-help"></td><td>About</td></tr>';break;default:return void hideContextMenu()}document.body.appendChild(contextMenu),contextMenu.style.top=n.y+"px",contextMenu.style.left=n.x+"px",fitContextMenu(n),contextMenu.style.opacity=1}function hideContextMenu(){contextMenu&&(contextMenu.parentNode.removeChild(contextMenu),contextMenu=null,[].forEach.call(document.querySelectorAll(".hover-on"),function(e){e.classList.remove("hover-on")}));var e=document.getElementById("clickGuard");e&&e.parentNode.removeChild(e)}function fitContextMenu(e){contextMenu&&(e.x+contextMenu.offsetWidth>window.innerWidth&&(contextMenu.style.left=e.x-(e.x+contextMenu.offsetWidth-window.innerWidth)+"px"),e.y+contextMenu.offsetHeight>window.innerHeight&&(contextMenu.style.top=e.y-(e.y+contextMenu.offsetHeight-window.innerHeight)+"px"))}function getPosition(e){var t=0,i=0;return e.pageX||e.pageY?(t=e.pageX,i=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:t,y:i}}function isMobile(){return(_mobile=null)&&!function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(_mobile=!0)}(navigator.userAgent||navigator.vendor||window.opera),_mobile?console.log("Mobile device detected."):console.log("Desktop device detected."),_mobile}function Queue(){this.Container=queueDOM,this.items=[],Queue.prototype.hasItems||(Queue.prototype.hasItems=function(){return this.items.length>0}),Queue.prototype.pushItem||(Queue.prototype.pushItem=function(e){this.items.push(e),e.Container.classList.toggle("queued"),this.update()}),Queue.prototype.popItem||(Queue.prototype.popItem=function(){var e=this.items.shift();return e.Container.classList.toggle("queued"),this.update(),e}),Queue.prototype.removeItemAt||(Queue.prototype.removeItemAt=function(e){var t=this.items.splice(e,1)[0];t.Container.classList.toggle("queued"),this.update()}),Queue.prototype.update||(Queue.prototype.update=function(){if(this.hasItems()){document.getElementById("queueButton").classList.add("alt"),this.Container.clear();for(var e=0;e<this.items.length;e++){var t=document.createElement("li");t.className="container",t.innerHTML=this.items[e].Container.innerHTML,t.setAttribute("index",e),t.setAttribute("_context","queue"),this.Container.appendChild(t)}}else document.getElementById("queueButton").classList.remove("alt"),this.Container.innerHTML='<div class="empty-queue"><span>Empty Queue</span></div>'}),Queue.prototype.show||(Queue.prototype.show=function(){this.update()}),Queue.prototype.close||(Queue.prototype.close=function(){})}function addToQueue(e){var t=selectedList.items[e];t&&queue.pushItem(t),isPlaying||getNext()}function removeQueueItem(e){queue.removeItemAt(e)}function skipQueueTo(e){var t=queue.items[e];if(t){for(var i=0;i<e;i++)queue.popItem();playVideo(queue.popItem())}}function toggleQueue(){QueueVisible=!QueueVisible;var e=document.getElementById("queueButton");e.classList.toggle("queueactive"),QueueVisible?(document.getElementById("PlaylistContainer").style.left="-100%",queue.update()):(document.getElementById("PlaylistContainer").style.left="0",refresh())}function showQueue(){queue.show()}function share(e){var t=playlists[e];if(!t)return!1;var i=document.createElement("div"),n=document.createElement("input");n.className="selectable textbox",i.appendChild(n);for(var s=!1,a=window.location.host+"#"+t.title+"=",l=0;l<t.items.length;l++)if(a+=(l>0?",":"")+t.items[l].videoId,a.length>6910){s=!0;break}t.items.length>0?short.shorten(encodeURIComponent(a),function(e){n.value=e.shorturl,n.focus(),n.select()}):n.value="Empty list :(",showDim();var o=document.createElement("span");o.className="panel dark-ui smaller",o.addEventListener("click",function(e){e.stopPropagation()}),o.addEventListener("contextmenu",function(e){e.stopPropagation()}),dimmer.appendChild(o),o.innerHTML="<h2>Share playlist</h2><p>"+t.title+"</p>",o.appendChild(i),s&&(o.innerHTML+='<p class="smaller">Some items were left out (list too long)</p>'),n.focus(),n.select()}function showItemUrl(e){showDim();var t=document.createElement("span");dimmer.appendChild(t),t.className="panel dark-ui smaller",t.innerHTML="<h2>Link to video </h2><p>"+selectedList.items[e].title+"</p",t.addEventListener("click",function(e){e.stopPropagation()}),t.addEventListener("contextmenu",function(e){e.stopPropagation()});var i=document.createElement("input");t.appendChild(i),i.className="selectable textbox",i.value="https://youtu.be/"+selectedList.items[e].videoId,i.focus(),i.select()}function showAbout(){showDim();var e=document.createElement("span");e.className="panel dark-ui smaller",e.innerHTML='<h2>Playeri.net</h2><p>&copy; Antti Lamminsalo 2014 - 2015</p><p>antti.lamminsalo@playeri.net</p></br><h2>Special thanks</h2><p><a href="https://fortawesome.github.io/Font-Awesome/">Font Awesome</a></p><p><a href="http://www.entypo.com/">Entypo</a></p><p><a href="https://modernpictograms.com/">Modern Pictograms</a></p><p><a href="http://fontello.com">Fontello</a></p>',e.addEventListener("click",function(e){e.stopPropagation()}),e.addEventListener("contextmenu",function(e){e.stopPropagation()}),dimmer.appendChild(e)}function showDim(){dimmer&&(clearTimeout(dimtimer),document.body.removeChild(dimmer)),dimmer=document.createElement("div"),dimmer.id="screendim",dimmer.className="centerX centerY",dimmer.addEventListener("click",hideOverlayPlayer),dimmer.addEventListener("contextmenu",hideOverlayPlayer,!0),dimmer.style.zIndex=200,document.body.appendChild(dimmer),dimmer.style.opacity=0,window.getComputedStyle(dimmer).opacity,dimmer.style.opacity=1}function showOverlayPlayer(){showDim();var e=document.getElementById("player-wrap");e.classList.add("playerOverlay"),e.style.height="60vh",e.style.width=1.7777*e.offsetHeight+"px"}function hideOverlayPlayer(e){var t=document.getElementById("player-wrap");t.classList.remove("playerOverlay"),t.style.height="initial",t.style.width="initial",unDim(),e.stopPropagation(),e.preventDefault()}function unDim(){dimmer&&(dimmer.style.opacity=0,dimtimer=setTimeout(function(){dimmer&&(document.body.removeChild(dimmer),dimmer=null)},400),hideContextMenu())}function getItemThumb(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState){var e=JSON.parse(t.responseText);document.getElementById("current-img").setAttribute("src",e.items[0].snippet.thumbnails["default"].url)}};var i="https://www.googleapis.com/youtube/v3/videos?key="+APIkey+"&part=snippet&fields=items(snippet(thumbnails(default)))&id="+e.videoId;t.open("GET",i,!0),t.send()}function showSettings(){showDim(),settings||(settings=document.createElement("span"),settings.className="panel dark-ui",settings.innerHTML='<h2>Settings</h2><table><tr><td class="smaller">Highest quality</td><td id="qualityButton" class="switch"><a></a></td></tr><tr><td class="smaller">Switch theme</td><td id="themeButton" class="switch"><a></a></td></tr></table>',
settings.addEventListener("click",function(e){e.stopPropagation()}),settings.addEventListener("contextmenu",function(e){e.stopPropagation()}),settings.getElementsByClassName("switch")[0].addEventListener("click",toggleQuality),settings.getElementsByClassName("switch")[1].addEventListener("click",toggleTheme)),dimmer.appendChild(settings)}function is_touch_device(){return"ontouchstart"in window||navigator.maxTouchPoints}function toggleQuality(){HighQuality=!HighQuality,this.children[0].classList.toggle("activeknob"),this.children[0].style.left=HighQuality?this.offsetWidth-4-this.children[0].offsetWidth+"px":this.children[0].style.left="0",isPlaying&&player.setPlaybackQuality(HighQuality?player.getAvailableQualityLevels()[0]:"default")}function toggleTheme(){OldTheme=!OldTheme,this.children[0].classList.toggle("activeknob"),this.children[0].style.left=OldTheme?this.children[0].style.left="0":this.offsetWidth-4-this.children[0].offsetWidth+"px",document.getElementById("css_theme").href=OldTheme?"css/dark.min.css":"css/modernflat.min.css"}var APIkey="AIzaSyAvUkwnZgyRixQ6oM86DzvHBTU4nKop9uQ",playlistDOM=document.getElementById("playlist"),playlistsDOM=document.getElementById("playlists"),resultsDOM=document.getElementById("searchList"),queueDOM=document.getElementById("queuelist");window.onload=function(){isMobile()||is_touch_device()?document.getElementById("addPlaylistButton").style.visibility="visible":createSortables()};var lptimer,plSortable=void 0,player,playerVisible,HighQuality=!1,isPlaying=!1,tokenList="",nextToken="",_scrollEvent=function(){this.scrollTop+this.offsetHeight>this.scrollHeight-4&&nextToken&&(tokenList.indexOf(nextToken)===-1&&(tokenList+=nextToken+"|",search(nextToken)),document.getElementById("results-wrap").removeEventListener("scroll",_scrollEvent))},intervalId=null,errorCounter=0,ShuffleOn=!1,activeItem=null,playlists=[],activeList=null,selectedList=null;Node.prototype.clear=function(){for(;this.firstChild;)this.removeChild(this.firstChild)};var editedPlaylist,_renameDone=function(e){if(!e||13===e.keyCode||"blur"===e.type){this.removeEventListener("blur",_renameDone),this.removeEventListener("keyup",_renameDone),editedPlaylist.Container.classList.remove("editing");var t=editedPlaylist.titleDOM,i=editedPlaylist.renameDOM;t.classList.remove("hidden"),i.classList.add("hidden"),i=i.children[0],i.value&&(t.textContent=i.value,editedPlaylist.title=i.value,editedPlaylist.renamed=!0,saveStoredPlaylists(),editedPlaylist=null),!isMobile()&&plSortable&&plSortable.option("disabled",!1)}};Array.prototype.last=function(){return this[this.length-1]},Array.prototype.dragSort=function(e,t){var i=this.splice(e,1)[0];this.splice(t,0,i)},Array.prototype.removeObj=function(e){var t=this.indexOf(e);return t!==-1&&(this.splice(t,1),!0)};var contextMenu=null,_mobile=null,queue=new Queue,QueueVisible=!1,short=yourls.connect("http://playeri.net/public_api.php"),dimmer=null,dimtimer,settings=null,OldTheme=!0;